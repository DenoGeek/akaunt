services:
  app:
    image: ghcr.io/denogeek/akaunt:akaunt-latest
    # Or build locally: uncomment below and remove image above
    # build: .
    ports:
      - "3000:3000"
    depends_on:
      db:
        condition: service_healthy
    environment:
      - DATABASE_URL=postgresql://akaunt:akaunt_secret@db:5432/akaunt?schema=public
      - NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=
      - CLERK_SECRET_KEY=
      - CRON_SECRET=
      - NODE_ENV=production

  # db:
  #   image: postgres:16-alpine
  #   restart: unless-stopped
  #   environment:
  #     POSTGRES_USER=akaunt
  #     POSTGRES_PASSWORD=akaunt_secret
  #     POSTGRES_DB=akaunt
  #   volumes:
  #     - postgres_data:/var/lib/postgresql/data
  #   healthcheck:
  #     test: ["CMD-SHELL", "pg_isready -U akaunt -d akaunt"]
  #     interval: 5s
  #     timeout: 5s
  #     retries: 5

volumes:
  postgres_data:
